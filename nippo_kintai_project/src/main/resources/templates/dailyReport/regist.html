<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
	<link th:href="@{/css/style.css}" rel="stylesheet">

	<title>日報登録</title>
</head>

<body>

	<!-- ヘッダー -->
	<div class="container mt-3 mb-3">
		<div class="d-flex align-items-center gap-5">
			<div>
				<strong>ユーザー名：</strong>
				<span th:text="${session.loginUser.name}"></span>
			</div>
			<div>
				<strong>ユーザーID：</strong>
				<span th:text="${session.loginUser.id}"></span>
			</div>
			<div>
				<strong>ステータス：</strong>
				<span th:text="${statusName}"></span>
			</div>
	
			<div class="ms-auto d-flex gap-2">
				<a href="/common/startMenu">
					<input type="submit" name="startMenuBack" value="戻る" class="btn-yellow" />
				</a>
	
				<form th:action="@{/common/logoff}" method="post">
					<button type="submit" class="btn-yellow">ログオフ</button>
				</form>
		</div>
	</div>
	</div>
	<!-- ヘッダー -->


	<div class="container mt-3 mb-3 border" style="background-color: white; ">
	<div class="container mt-5 mb-2">
		<div class="row ms-2">
			
			<form id="dailyReport-form" name="dailyReportForm" method="post" action="/dailyReport/change">
				<strong>対象日付：</strong>
				
				<input type="date" name="date" id="today" form="dailyReport-form" />

			</form>
		</div>
	</div>
	<script>
		const inputElem = document.getElementById("today");

		inputElem.addEventListener('change', (event) => {
			// フォームを送信
			document.getElementById("dailyReport-form").submit();
		});

		// input要素オブジェクト
		//const inputElem = document.getElementById("today");


		//inputElem.addEventListener('change', (event) => {
		//document.dateForm.submit();
		//window.location.href = '/dailyReport/change';
		//submit()でフォームの内容を送信

		//});
	</script>


<!--	変更しました-->

	<!--				<form>-->
	<!--					<strong>表示年月日：</strong>-->
	<!--					<input type="text" size="8" />年-->
	<!--					<input type="text" size="8" />月-->
	<!--					<input type="text" size="8" />日-->
	<!--					<input type="submit" class="btn-yellow ms-3" value="表示" />-->
	<!--				</form>-->

	
<!--	<div class="container d-flex flex-row-reverse">-->
<!--		<a href="/common/startMenu">-->
<!--			<input type="submit" name="startMenuBack" value="戻る" class="btn-yellow ms-2" />-->
<!--		</a>-->
<!--	</div>-->
	
		<!--「提出」初期表示は非活性(作業時間、内容が入力されると活性化)-->
		<!-- 既に提出済みの場合は非活性にする-->
<button type="submit" id="submitBtn" class="btn-yellow" form="dailyReport-form" disabled>提出</button>

	</div>

<!--	<div class="container mt-3 mb-3 border" style="background-color: white; ">-->
	<div class="container mt-3 mb-3">


		<form th:object="${dailyReport}" th:action="@{/dailyReport/regist/complete}" method="post"
			id="dailyReport-form">

			<input type="hidden" name="userId" th:value="${session.loginUser.id}" />
			<input type="hidden" name="id" th:value="${dailyReport.id !=null ? dailyReport.id : 0}" />
			<!-- カレンダーの日付からdateを取得 -->

			<table class="table table-hover table-bordered" style="width:80%;" id="dailyReportTbl">
			<thead style="background-color: white; ">
					<tr>
						<th width="20%">作業時間（h）</th>
						<th width="70%">作業内容</th>
					</tr>
				</thead>
			
			<tbody style="background-color: white; ">
					<th:block th:each="dailyReportDetail, stat : *{DailyReportFormDetailList}">
						<th:block>
							<input type="hidden" th:name="|dailyReportDetail[${stat.index}].id|"
								th:value="${dailyReportDetail.id !=null ? dailyReportDetail.id : 0}" />
							<input type="hidden" th:name="|dailyReportDetail[${stat.index}].userId|"
								th:value="${dailyReportDetail.userId !=null ? dailyReportDetail.userId : 0}" />
							<input type="hidden" th:name="|dailyReportDetail[${stat.index}].date|"
								th:value="${dailyReportDetail.date !=null ? dailyReportDetail.date : 0}"
								id="hidden-date" />

						</th:block>
						<tr>
						

							<td><input type="number" step="0.5" class="form-control"
									th:name="|dailyReportDetail[${stat.index}].time|"
									th:value="${dailyReportDetail.time}" /></td>
							<td><input type="text" class="form-control"
									th:name="|dailyReportDetail[${stat.index}].content|"
									th:value="${dailyReportDetail.content}" /></td>
						</tr>
					</th:block>

					<!-- 新しい入力フィールドを追加する -->
					<!--					<tr>-->
					<!--						<td><input type="number" step="0.5" class="form-control" />-->
					<!--						</td>-->
					<!--						<td><input type="text" class="form-control"/>-->
					<!--						</td>-->
					<!--					</tr>-->
				</tbody>
			</table>

		</form>

	</div>
	<div class="container mb-5">
		<input type="button" value="追加" onclick="add()" />
		<input type="button" value="削除" onclick="del()" />
	</div>

<!--	</div>-->

</div>



	<script th:src="@{/js/dailyReport.js}"></script>
</body>

</html>